<?xml version="1.0"?>

<robot xmlns:xacro="http://www.ros.org/wiki/xacro">
  <xacro:property name="M_PI" value="3.1415926535897931"/>

  <xacro:macro name="add_optical_frame" params="name">
		<joint name="${name}_optical_joint" type="fixed">
			<origin xyz="0 0 0" rpy="0.0 0.0 0.0" />
			<parent link="${name}" />
			<child link="${name}_optical_frame"/>
		</joint>

		<link name="${name}_optical_frame" />
	</xacro:macro>

  <xacro:macro name="realsense_gazebo">
		<gazebo reference="camera_link_optical_frame">
			<sensor type="camera" name="realsense">
				<always_on>true</always_on>
				<visualize>true</visualize>
				<update_rate>15</update_rate>
				<gz_frame_id>camera_link_optical_frame</gz_frame_id>

				<camera>
					<optical_frame_id>camera_link_optical_frame</optical_frame_id>
					<horizontal_fov>1.047</horizontal_fov>
					<image>
						<width>640</width>
						<height>480</height>
					</image>
					<depth_camera>
						<clip>
							<near>0.1</near>
							<far>10.0</far>
						</clip>
					</depth_camera>
					<noise>
						<type>gaussian</type>
						<mean>0.0</mean>
						<stddev>0.01</stddev>
					</noise>
				</camera>
                <plugin name="realsense_camera_plugin" filename="libgazebo_ros_camera.so">
                    <ros>
                    <remapping>image_raw:=/realsense/image_color/raw</remapping>
                    <remapping>camera_info:=/realsense/image_color/camera_info</remapping>
                    <frame_name>camera_link_optical_frame</frame_name>
                    </ros>
                </plugin>
			</sensor>
            <sensor type="depth" name="realsense_depth">
				<always_on>true</always_on>
				<visualize>true</visualize>
				<update_rate>15</update_rate>
				<gz_frame_id>camera_link_optical_frame</gz_frame_id>

				<camera>
					<optical_frame_id>camera_link_optical_frame</optical_frame_id>
					<horizontal_fov>1.047</horizontal_fov>
					<image>
						<width>640</width>
						<height>480</height>
					</image>
					<depth_camera>
						<clip>
							<near>0.1</near>
							<far>10.0</far>
						</clip>
					</depth_camera>
					<noise>
						<type>gaussian</type>
						<mean>0.0</mean>
						<stddev>0.01</stddev>
					</noise>
				</camera>
                <plugin name="realsense_camera_plugin" filename="libgazebo_ros_camera.so">
                    <ros>
                    <remapping>image_raw:=/realsense/image_depth/raw</remapping>
                    <remapping>camera_info:=/realsense/image_depth/camera_info</remapping>
                    <frame_name>camera_link_optical_frame</frame_name>
                    </ros>
                </plugin>
			</sensor>
		</gazebo>
	</xacro:macro>
  
  <xacro:macro name="realsense_camera" params="name parent *origin">

      <link name="head_pan_link_static">
          <inertial>
              <origin rpy="0 0 0" xyz="-1.35308431126191E-16 -2.97071395261028E-17 0.0220876265081744"/>
              <mass value="0.0182769203076134"/>
              <inertia ixx="1.32243845065555E-05" ixy="5.07660179129181E-13" ixz="1.067515220067E-20" iyy="7.13386116649085E-06" iyz="-1.32882457845217E-20" izz="7.83291781352837E-06"/>
          </inertial>
      </link>
      <link name="head_pan_link">
          <inertial>
              <origin rpy="0 0 0" xyz="-1.35308431126191E-16 -2.97071395261028E-17 0.0220876265081744"/>
              <mass value="0.0182769203076134"/>
              <inertia ixx="1.32243845065555E-05" ixy="5.07660179129181E-13" ixz="1.067515220067E-20" iyy="7.13386116649085E-06" iyz="-1.32882457845217E-20" izz="7.83291781352837E-06"/>
          </inertial>
          <visual>
              <origin rpy="0 0 0" xyz="0 0 0"/>
              <geometry>
                  <mesh filename="package://sensors_description/meshes/tilt_link.STL"/>
              </geometry>
              <material name="">
                  <color rgba="0.250980392156863 0.250980392156863 0.250980392156863 1"/>
              </material>
          </visual>
          <collision>
              <origin rpy="0 0 0" xyz="0 0 0"/>
              <geometry>
                  <mesh filename="package://sensors_description/meshes/tilt_link.STL"/>
              </geometry>
          </collision>
      </link>

      <joint name="head_pan_joint_static" type="fixed">
          <xacro:insert_block name="origin"/>
          <parent link="${parent}"/>
          <child link="head_pan_link_static"/>
          <axis xyz="0 0 1"/>
          <limit effort="1" lower="-1.57" upper="1.57" velocity="1"/>
      </joint>
      <joint name="head_pan_joint" type="revolute">
          <xacro:insert_block name="origin"/>
          <parent link="${parent}"/>
          <child link="head_pan_link"/>
          <axis xyz="0 0 1"/>
          <limit effort="1" lower="-1.57" upper="1.57" velocity="1"/>
      </joint>

      <link name="head_tilt_link_static">
          <inertial>
              <origin rpy="0 0 0" xyz="0.0168744200088311 -0.000442984145897884 -0.00405256422002387"/>
              <mass value="0.0547677687275323"/>
              <inertia ixx="1.07071738005716E-05" ixy="-1.46854788384565E-07" ixz="5.59529059364376E-08" iyy="1.77011620295824E-05" iyz="1.27587154712834E-09" izz="2.01583693170578E-05"/>
          </inertial>
      </link>
      <link name="head_tilt_link">
          <inertial>
              <origin rpy="0 0 0" xyz="0.0168744200088311 -0.000442984145897884 -0.00405256422002387"/>
              <mass value="0.0547677687275323"/>
              <inertia ixx="1.07071738005716E-05" ixy="-1.46854788384565E-07" ixz="5.59529059364376E-08" iyy="1.77011620295824E-05" iyz="1.27587154712834E-09" izz="2.01583693170578E-05"/>
          </inertial>
          <visual>
              <origin rpy="0 0 0" xyz="0 0 0"/>
              <geometry>
                  <mesh filename="package://sensors_description/meshes/roll_link.STL"/>
              </geometry>
              <material name="">
                  <color rgba="0.792156862745098 0.819607843137255 0.933333333333333 1"/>
              </material>
          </visual>
          <collision>
              <origin rpy="0 0 0" xyz="0 0 0"/>
              <geometry>
                  <mesh filename="package://sensors_description/meshes/roll_link.STL"/>
              </geometry>
          </collision>
      </link>

      <joint name="head_tilt_joint_static" type="fixed">
          <origin rpy="0 0 0" xyz="0 0 0.05"/>
          <parent link="head_pan_link_static"/>
          <child link="head_tilt_link_static"/>
          <axis xyz="0 1 0"/>
          <limit effort="1" lower="-1.57" upper="1.57" velocity="1"/>
      </joint>
      <joint name="head_tilt_joint" type="revolute">
          <origin rpy="0 0 0" xyz="0 0 0.05"/>
          <parent link="head_pan_link"/>
          <child link="head_tilt_link"/>
          <axis xyz="0 1 0"/>
          <limit effort="1" lower="-1.57" upper="1.57" velocity="1"/>
      </joint>

      <link name="camera_link_static">
        <inertial>
            <origin rpy="0 0 0" xyz="-0.0132722976093535 0.00168171470080143 2.49829664994428E-06"/>
            <mass value="0.0381925651163644"/>
            <inertia ixx="2.4688255642946E-05" ixy="1.60697655569215E-07" ixz="1.2993241737711E-08" iyy="3.66669176935806E-06" iyz="1.30215657011203E-08" izz="2.48602467766615E-05"/>
        </inertial>
      </link>
      <link name="camera_link">
        <inertial>
            <origin rpy="0 0 0" xyz="-0.0132722976093535 0.00168171470080143 2.49829664994428E-06"/>
            <mass value="0.0381925651163644"/>
            <inertia ixx="2.4688255642946E-05" ixy="1.60697655569215E-07" ixz="1.2993241737711E-08" iyy="3.66669176935806E-06" iyz="1.30215657011203E-08" izz="2.48602467766615E-05"/>
        </inertial>
        <visual>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="package://sensors_description/meshes/camera_link.STL"/>
            </geometry>
            <material name="">
                <color rgba="0.792156862745098 0.819607843137255 0.933333333333333 1"/>
            </material>
        </visual>
        <collision>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="package://sensors_description/meshes/camera_link.STL"/>
            </geometry>
        </collision>
      </link>

      <joint name="camera_joint_static" type="fixed">
          <origin rpy="0 0 0" xyz="0.06705 0 -0.00425"/>
          <parent link="head_tilt_link_static"/>
          <child link="camera_link_static"/>
          <axis xyz="0 0 0"/>
      </joint>
      <joint name="camera_joint" type="fixed">
          <origin rpy="0 0 0" xyz="0.06705 0 -0.00425"/>
          <parent link="head_tilt_link"/>
          <child link="camera_link"/>
          <axis xyz="0 0 0"/>
      </joint>
      <ros2_control name="head_hardware_interface" type="system">
    <hardware>
      <plugin>gazebo_ros2_control/GazeboSystem</plugin>
    </hardware>

    <joint name="head_pan_joint">
      <command_interface name="position">
      </command_interface>
      <state_interface name="position"/>
    </joint>

    <joint name="head_tilt_joint">
      <command_interface name="position">
      </command_interface>
      <state_interface name="position"/>
    </joint>
  </ros2_control>
  </xacro:macro>
</robot>
